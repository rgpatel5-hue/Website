<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drop for Drop - Game | charity: water</title>
  <meta name="description" content="Drop for Drop - An educational game about water access. Learn to identify safe water sources.">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #005587 0%, #0077B5 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      color: #1A1A1A;
    }

    .game-container {
      width: 100%;
      max-width: 800px;
      background: #F5F5F5;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      padding: 2rem;
      min-height: 500px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #00A3E0;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: #005587;
    }

    .logo span {
      color: #FFC82C;
    }

    .home-btn {
      background: #FFC82C;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .home-btn:hover {
      background: #FFCF50;
    }

    /* Screen Visibility */
    .screen {
      display: none;
    }

    .screen.active {
      display: flex;
      flex-direction: column;
    }

    /* Intro Screen */
    .intro-screen {
      text-align: center;
      gap: 2rem;
    }

    .intro-screen h1 {
      font-size: 2.5rem;
      color: #005587;
      margin-bottom: 1rem;
    }

    .intro-screen p {
      font-size: 1.1rem;
      color: #4A4A4A;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      padding: 0.8rem 2rem;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #0077B5;
      color: white;
    }

    .btn-primary:hover {
      background: #005587;
    }

    .btn-secondary {
      background: #FFC82C;
      color: #1A1A1A;
    }

    .btn-secondary:hover {
      background: #FFCF50;
    }

    /* Gameplay Screen */
    .gameplay-screen {
      gap: 1.5rem;
    }

    .game-header {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-box {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #00A3E0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .stat-label {
      font-size: 0.85rem;
      color: #4A4A4A;
      font-weight: 600;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 1.8rem;
      color: #005587;
      font-weight: 800;
      margin-top: 0.5rem;
    }

    .progress-section {
      margin: 1.5rem 0;
    }

    .progress-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: #005587;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: #E0E0E0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #0077B5 0%, #00A3E0 100%);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 0.5rem;
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .wellbeing-fill {
      background: linear-gradient(90deg, #DB4648 0%, #E5B327 100%);
    }

    .source-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .source-card {
      background: white;
      border: 2px solid #E0E0E0;
      padding: 1.5rem;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .source-card:hover {
      border-color: #00A3E0;
      box-shadow: 0 4px 12px rgba(0, 163, 224, 0.2);
      transform: translateY(-2px);
    }

    .source-card.correct {
      border-color: #0F9F3D;
      background: #E8F5E9;
      animation: pulse-correct 0.6s ease;
    }

    .source-card.incorrect {
      border-color: #DB4648;
      background: #FFEBEE;
      animation: shake 0.4s ease;
    }

    .source-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .source-name {
      font-size: 0.95rem;
      color: #005587;
    }

    .feedback-area {
      min-height: 50px;
      padding: 1rem;
      border-radius: 8px;
      background: #F0F0F0;
      text-align: center;
      display: none;
      font-weight: 600;
      font-size: 1rem;
    }

    .feedback-area.active {
      display: block;
    }

    .feedback-correct {
      background: #E8F5E9;
      color: #0F9F3D;
      border-left: 4px solid #0F9F3D;
    }

    .feedback-incorrect {
      background: #FFEBEE;
      color: #DB4648;
      border-left: 4px solid #DB4648;
    }

    .fact-toast {
      background: #FFC82C;
      color: #1A1A1A;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-weight: 600;
      animation: slide-in 0.3s ease;
    }

    .round-info {
      text-align: center;
      font-size: 0.9rem;
      color: #4A4A4A;
      margin-bottom: 1rem;
    }

    /* End Screen */
    .end-screen {
      text-align: center;
      gap: 1.5rem;
    }

    .end-screen h1 {
      font-size: 2rem;
      color: #005587;
      margin-bottom: 1rem;
    }

    .end-stats {
      background: #F0F0F0;
      padding: 2rem;
      border-radius: 10px;
      margin: 1.5rem 0;
    }

    .end-stat {
      margin: 1rem 0;
      font-size: 1.1rem;
      color: #4A4A4A;
    }

    .end-stat-value {
      font-size: 1.8rem;
      font-weight: 800;
      color: #0077B5;
    }

    .end-message {
      font-size: 1rem;
      line-height: 1.6;
      color: #4A4A4A;
      margin: 1.5rem 0;
      font-style: italic;
    }

    .how-to-screen {
      text-align: left;
      gap: 1rem;
      overflow-y: auto;
      max-height: 70vh;
    }

    .how-to-screen h1 {
      color: #005587;
      font-size: 2rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .how-to-screen h2 {
      color: #0077B5;
      font-size: 1.2rem;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .how-to-screen p {
      color: #4A4A4A;
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    .how-to-screen ul {
      margin-left: 1.5rem;
      color: #4A4A4A;
      line-height: 1.8;
    }

    .how-to-screen li {
      margin-bottom: 0.5rem;
    }

    /* Animations */
    @keyframes pulse-correct {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(15, 159, 61, 0.5); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    @keyframes slide-in {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fact-toast {
      animation: slide-in 0.3s ease, slide-out 0.3s ease 2.7s forwards;
    }

    @keyframes slide-out {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-10px); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .game-container {
        padding: 1.5rem;
      }

      .game-header {
        grid-template-columns: 1fr;
      }

      .intro-screen h1 {
        font-size: 1.8rem;
      }

      .source-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .game-container {
        padding: 1rem;
      }

      .intro-screen h1 {
        font-size: 1.5rem;
      }

      .source-grid {
        grid-template-columns: 1fr;
      }

      .stat-value {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <header>
      <div class="logo">charity<span>:</span> water</div>
      <button class="home-btn" onclick="window.location.href='/'">‚Üê Back to Home</button>
    </header>

    <!-- Intro Screen -->
    <div class="screen intro-screen active">
      <h1>Drop for Drop</h1>
      <p>Learn to identify safe water sources. Every correct choice fills the tank and saves lives.</p>
      <p style="font-size: 0.95rem; color: #666;">Click the clean water source to fill the tank. You have 60 seconds!</p>
      <div class="button-group">
        <button class="btn-primary" onclick="startGame()">Start Game</button>
        <button class="btn-secondary" onclick="showHowToPlay()">How to Play</button>
      </div>
    </div>

    <!-- How to Play Screen -->
    <div class="screen how-to-screen">
      <h1>How to Play</h1>
      <div style="text-align: left;">
        <h2>üéØ Objective</h2>
        <p>Fill the water tank by selecting clean water sources before time runs out.</p>

        <h2>üíß Game Mechanics</h2>
        <ul>
          <li><strong>Each round:</strong> You'll see 3-5 water sources</li>
          <li><strong>Your task:</strong> Click the clean, safe water source</li>
          <li><strong>Correct choice:</strong> Tank fills by 8%, you gain 10 drops</li>
          <li><strong>Wrong choice:</strong> Well-being drops by 12%, you lose 5 drops</li>
          <li><strong>Time limit:</strong> 60 seconds to fill the tank 100%</li>
        </ul>

        <h2>üìä What You're Managing</h2>
        <ul>
          <li><strong>Tank Fill %:</strong> Your progress toward the goal</li>
          <li><strong>Well-being:</strong> Your resilience‚Äîrunning out ends the game</li>
          <li><strong>Drops:</strong> Your score for correct choices</li>
          <li><strong>Time:</strong> The countdown to completion</li>
        </ul>

        <h2>üåü Tips</h2>
        <ul>
          <li>Read each source carefully before clicking</li>
          <li>Think about water safety in real life</li>
          <li>Build streaks of correct answers to earn bonus insights</li>
          <li>If you make a mistake, don't worry‚Äîkeep going!</li>
        </ul>

        <h2>üéì Learn</h2>
        <p>This game reflects real challenges faced by communities without safe water access. Every choice teaches something about water safety and the importance of clean water access initiatives.</p>
      </div>
      <div style="margin-top: 2rem; text-align: center;">
        <button class="btn-primary" onclick="startGame()">Ready to Play!</button>
        <button class="btn-secondary" onclick="backToIntro()" style="margin-left: 1rem;">Back</button>
      </div>
    </div>

    <!-- Gameplay Screen -->
    <div class="screen gameplay-screen">
      <div class="game-header">
        <div class="stat-box">
          <div class="stat-label">Time Left</div>
          <div class="stat-value" id="timerDisplay">60s</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Drops</div>
          <div class="stat-value" id="dropsDisplay">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Streak</div>
          <div class="stat-value" id="streakDisplay">0</div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-label">
          <span>Tank Fill</span>
          <span id="tankPercentDisplay">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="tankFill" style="width: 0%;"></div>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-label">
          <span>Well-being</span>
          <span id="wellBeingPercentDisplay">100%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill wellbeing-fill" id="wellBeingFill" style="width: 100%;"></div>
        </div>
      </div>

      <div class="round-info">
        <p>Round <span id="roundNumber">1</span> ‚Äî Select the clean water source</p>
      </div>

      <div class="source-grid" id="sourceGrid"></div>

      <div class="feedback-area" id="feedbackArea"></div>
      <div id="factToast"></div>
    </div>

    <!-- End Screen -->
    <div class="screen end-screen">
      <h1 id="endTitle">Game Over!</h1>
      <div class="end-stats">
        <div class="end-stat">
          Total Drops Collected
          <div class="end-stat-value" id="endDrops">0</div>
        </div>
        <div class="end-stat">
          Tank Fill
          <div class="end-stat-value" id="endTank">0%</div>
        </div>
        <div class="end-stat">
          Best Streak
          <div class="end-stat-value" id="endStreak">0</div>
        </div>
      </div>
      <div class="end-message" id="endMessage"></div>
      <div class="button-group">
        <button class="btn-primary" onclick="startGame()">Play Again</button>
        <button class="btn-secondary" onclick="window.location.href='/'">Back to Home</button>
      </div>
    </div>
  </div>

  <script>
    // Game State
    let gameState = {
      timeLeft: 60,
      tankFill: 0,
      wellBeing: 100,
      drops: 0,
      roundNumber: 1,
      correctStreak: 0,
      bestStreak: 0,
      gameActive: false,
      timerInterval: null,
      sources: []
    };

    const waterSources = {
      clean: [
        { name: 'Community Well', icon: 'üíß', safe: true },
        { name: 'Treated Water', icon: '‚ú®', safe: true },
        { name: 'Rainwater Tank', icon: '‚òî', safe: true },
        { name: 'Spring Water', icon: 'üåä', safe: true },
        { name: 'Boiled Water', icon: 'üî•', safe: true }
      ],
      unsafe: [
        { name: 'River', icon: 'üåä', safe: false },
        { name: 'Stagnant Pond', icon: 'üê∏', safe: false },
        { name: 'Contaminated Well', icon: '‚ò†Ô∏è', safe: false },
        { name: 'Drainage', icon: 'üö´', safe: false },
        { name: 'Untreated Stream', icon: 'ü™®', safe: false }
      ]
    };

    const facts = [
      'üíß Access to clean water is a human right, yet 703 million people lack it.',
      'üåç One person dies every 21 seconds from water-related diseases.',
      '‚è∞ A simple well can transform a community in weeks.',
      'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Children collect water for 8+ hours daily in many regions.',
      'üè• Clean water prevents 99% of water-borne illness deaths.',
      'üå± Water access improves school attendance by 50%.',
      'üí™ Education about water safety saves lives in every community.'
    ];

    function showScreen(screenName) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.querySelector(`.${screenName}`).classList.add('active');
    }

    function backToIntro() {
      showScreen('intro-screen');
    }

    function showHowToPlay() {
      showScreen('how-to-screen');
    }

    function startGame() {
      gameState = {
        timeLeft: 60,
        tankFill: 0,
        wellBeing: 100,
        drops: 0,
        roundNumber: 1,
        correctStreak: 0,
        bestStreak: 0,
        gameActive: true,
        timerInterval: null,
        sources: []
      };

      showScreen('gameplay-screen');
      generateRound();
      startTimer();
    }

    function startTimer() {
      gameState.timerInterval = setInterval(() => {
        gameState.timeLeft--;
        updateDisplay();

        if (gameState.timeLeft <= 0) {
          endGame(false);
        }

        if (gameState.tankFill >= 100) {
          endGame(true);
        }

        if (gameState.wellBeing <= 0) {
          endGame(false, 'wellbeing');
        }
      }, 1000);
    }

    function generateRound() {
      const numSources = 3 + Math.floor(Math.random() * 3); // 3-5 sources
      gameState.sources = [];

      // Pick one clean source
      const cleanSource = waterSources.clean[Math.floor(Math.random() * waterSources.clean.length)];
      gameState.sources.push({ ...cleanSource });

      // Pick remaining as unsafe
      const unsafeNeeded = numSources - 1;
      const unsafeUsed = new Set();

      while (gameState.sources.length < numSources) {
        const unsafe = waterSources.unsafe[Math.floor(Math.random() * waterSources.unsafe.length)];
        const key = unsafe.name;
        if (!unsafeUsed.has(key)) {
          gameState.sources.push({ ...unsafe });
          unsafeUsed.add(key);
        }
      }

      // Shuffle sources
      gameState.sources.sort(() => Math.random() - 0.5);
      renderSources();
    }

    function renderSources() {
      const grid = document.getElementById('sourceGrid');
      grid.innerHTML = '';

      gameState.sources.forEach((source, index) => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.innerHTML = `
          <div class="source-icon">${source.icon}</div>
          <div class="source-name">${source.name}</div>
        `;
        card.onclick = () => selectSource(index);
        grid.appendChild(card);
      });
    }

    function selectSource(index) {
      if (!gameState.gameActive) return;

      const source = gameState.sources[index];
      const card = document.querySelectorAll('.source-card')[index];

      if (source.safe) {
        handleCorrect(card);
      } else {
        handleIncorrect(card);
      }
    }

    function handleCorrect(card) {
      card.classList.add('correct');
      gameState.drops += 10;
      gameState.tankFill = Math.min(100, gameState.tankFill + 8);
      gameState.wellBeing = Math.min(100, gameState.wellBeing + 2);
      gameState.correctStreak++;
      gameState.bestStreak = Math.max(gameState.bestStreak, gameState.correctStreak);

      showFeedback('‚úì Clean choice! +10 drops', true);

      if (gameState.correctStreak % 3 === 0) {
        showFact();
      }

      updateDisplay();

      setTimeout(() => {
        if (gameState.gameActive && gameState.tankFill < 100 && gameState.wellBeing > 0) {
          gameState.roundNumber++;
          generateRound();
          clearFeedback();
        }
      }, 800);
    }

    function handleIncorrect(card) {
      card.classList.add('incorrect');
      gameState.drops = Math.max(0, gameState.drops - 5);
      gameState.tankFill = Math.max(0, gameState.tankFill - 2);
      gameState.wellBeing = Math.max(0, gameState.wellBeing - 12);
      gameState.correctStreak = 0;

      showFeedback('‚úó Not safe‚Äîtry another', false);
      updateDisplay();

      setTimeout(() => {
        if (gameState.gameActive && gameState.wellBeing > 0) {
          generateRound();
          clearFeedback();
        }
      }, 800);
    }

    function showFeedback(message, isCorrect) {
      const area = document.getElementById('feedbackArea');
      area.textContent = message;
      area.className = isCorrect ? 'feedback-area active feedback-correct' : 'feedback-area active feedback-incorrect';
    }

    function clearFeedback() {
      document.getElementById('feedbackArea').classList.remove('active');
    }

    function showFact() {
      const fact = facts[Math.floor(Math.random() * facts.length)];
      const toast = document.getElementById('factToast');
      toast.className = 'fact-toast';
      toast.textContent = fact;

      setTimeout(() => {
        toast.className = '';
        toast.textContent = '';
      }, 3000);
    }

    function updateDisplay() {
      document.getElementById('timerDisplay').textContent = gameState.timeLeft + 's';
      document.getElementById('dropsDisplay').textContent = gameState.drops;
      document.getElementById('streakDisplay').textContent = gameState.correctStreak;
      document.getElementById('roundNumber').textContent = gameState.roundNumber;

      document.getElementById('tankPercentDisplay').textContent = gameState.tankFill + '%';
      document.getElementById('tankFill').style.width = gameState.tankFill + '%';

      document.getElementById('wellBeingPercentDisplay').textContent = gameState.wellBeing + '%';
      document.getElementById('wellBeingFill').style.width = gameState.wellBeing + '%';
    }

    function endGame(won, reason = null) {
      gameState.gameActive = false;
      clearInterval(gameState.timerInterval);

      let title = 'Game Over!';
      let message = '';

      if (reason === 'wellbeing') {
        title = 'That was tough!';
        message = 'Access to clean water is complicated. Many communities face these decisions daily. Your empathy can help change this. Every donation brings hope.';
      } else if (won) {
        title = 'üéâ You filled the tank!';
        message = `You demonstrated the importance of clean water choices. In real life, communities don't always have safe options. Your understanding can drive change.`;
      } else {
        title = '‚è∞ Time\'s up!';
        message = `You collected ${gameState.drops} drops and proved that clean water decisions matter. Thank you for learning about global water challenges.`;
      }

      document.getElementById('endTitle').textContent = title;
      document.getElementById('endDrops').textContent = gameState.drops;
      document.getElementById('endTank').textContent = gameState.tankFill + '%';
      document.getElementById('endStreak').textContent = gameState.bestStreak;
      document.getElementById('endMessage').textContent = message;

      showScreen('end-screen');
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (gameState.gameActive) {
          gameState.gameActive = false;
          clearInterval(gameState.timerInterval);
          backToIntro();
        }
      }
    });
  </script>
</body>
</html>
